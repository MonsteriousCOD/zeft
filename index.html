<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:creator" content="@thegainlings">
  <meta name="twitter:site" content="@thegainlings" />
  <meta name="twitter:title" content="The Gainlings" />
  <meta name="description" content="Checkout the gainling battlefield">
  <meta property="og:title" content="The Gainlings">
  <meta property="og:description" content="Checkout the gainling battlefield">
  <meta property="og:url" content="https://testnet-fight.thegainlings.io">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://testnet-fight.thegainlings.io/assets/sprites/HeaderImage.jpg">
  <meta property="og:image:alt" content="Logo">
  <meta property="og:image:type" content="image/gif">
  <meta property="og:image:width" content="380">
  <meta property="og:image:height" content="150">
  <meta property="og:locale" content="en_EN">
  <meta property="og:site_name" content="The Gainlings">

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="assets/sprites/Logo.png">
  <!--font awesome-->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"
    integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--Compiled and minified CSS-->
  <!--Font-->
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&amp;display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jost&family=Press+Start+2P&display=swap" rel="stylesheet">
  <!--custom styles-->
  <link href="styles/style.css" rel="stylesheet">
  <title>The Gainlings - Fight</title>
</head>

<body>

  <header>
    <nav class="navbar">
      <div class="nav-wrapper">
        <image class="logo" src="assets/sprites/Logo.png" alt="logo"> </image>

        <div class="socialContainerInner">
          <a href="https://twitter.com/thegainlings" class="socialButton twitter" target="_blank"> </a>
          <a href="https://testnets.opensea.io/collection/the-gainlings-19" class="socialButton opensea" target="_blank">
          </a>
          <a href="https://the-gainlings.gitbook.io/the-gainlings/general/concept" class="socialButton gitbook"
            target="_blank"> </a>
          <a href="https://discord.gg/3v6TTkfuY8" class="socialButton discord" target="_blank"> </a>
          <a class="socialButton audioSource" id="soundButton"> </a>
        </div>

        <div class="pageLayoutSwitchContainer" id="pageLayoutSwitchContainer">
          <button class="pageLayoutSwitchButton itemsSwitchButton" id="itemsSwitchButton">All</button>
          <button class="pageLayoutSwitchButton ownedSwitchButton" id="ownedSwitchButton">Owned</button>
          <button class="pageLayoutSwitchButton historySwitchButton" id="historySwitchButton">History</button>
        </div>
        <div id="tokenSelectorContainer" class="tokenSelectorContainer">
          <button id="tokenSelectorButton" class="tokenSelectorButton">
            Select player
            <div class="imageInSelectorOptionContainer">
              <image id="clientBackground" class="imageInSelectorOption imagebehind selectedImage"
                src="assets/sprites/Character.png" alt="logo"> </image>
              <image id="clientCharacter" class="imageInSelectorOption imageTop selectedImage"
                src="assets/sprites/Character.png" alt="logo"> </image>
              <image id="clientHelmet" class="imageInSelectorOption imageTop selectedImage"
                src="assets/sprites/Character.png" alt="logo"> </image>
              <image id="clientWeapon" class="imageInSelectorOption imageTop selectedImage"
                src="assets/sprites/Character.png" alt="logo"> </image>
              <image id="clientArmour" class="imageInSelectorOption imageTop selectedImage"
                src="assets/sprites/Character.png" alt="logo"> </image>
              <image id="clientShield" class="imageInSelectorOption imageTop selectedImage"
                src="assets/sprites/Character.png" alt="logo"> </image>
              <image id="clientBoots" class="imageInSelectorOption imageTop selectedImage"
                src="assets/sprites/Character.png" alt="logo"> </image>
            </div>
          </button>

          <div id="tokenSelectorOptionContainer" class="tokenSelectorOptionContainer">

          </div>
        </div>
      </div>
    </nav>
  </header>

  <main>
    <audio id="audioElement" src="assets/sounds/cave.wav" loop> </audio>
    <div class="easyMeasure" id="easyMeasure">

    </div>


    <div class="flashyContainer" id="connectContainer">
      <div class="flashyRoundButton" id="connectButtonContainer">
        <div class="connectButtonContent" id="connectButtonContent">
          Please connect wallet
        </div>
      </div>
    </div>

    <div class="bannerContainer">
      <a class="className"></a>
      <div class="collectionCardContainer" id="collectionCardContainer">
        <div class="collectionCard" id="collectionCardSeason">
          Season: 1
        </div>
        <div class="distancer"></div>
        <div class="collectionCard" id="collectionCardStage">
          Stage: 0
        </div>
        <div class="distancer"></div>
        <div class="collectionCard" id="collectionCardAlive">
          Supply alive: 0
        </div>

      </div>

      <image src="assets/sprites/Sunrise.png" class="banner"></image>
    </div>

    <div class="filterHeader">
      <button class="filterButton" id="filterButton"></button>
      <div class="searchInputContainer">
        <input type="text" class="searchInput" placeholder="Search victim" id="tokenSearch">
        <label class="search" for="input-search"></label>
      </div>

      <div id="sortSelectorContainer" class="sortSelectorContainer">
        <button id="sortingButton" class="fakeSortSelector">Sort by</button>
        <button id="sortingBounty" class="fakeSortSelectorOption">Bounty </button>
        <button id="sortingStack" class="fakeSortSelectorOption">Stack </button>
        <button id="sortingAttack" class="fakeSortSelectorOption">Attack </button>
        <button id="sortingDefense" class="fakeSortSelectorOption">Defense </button>
        <button id="sortingPrice" class="fakeSortSelectorOption">Price </button>
      </div>

      <button class="refreshButton" id="refreshButton"></button>
    </div>

    <div class="totalContainer" id="mainContainer">

      <div class="leftPanelContainer" id="leftPanelContainer">

        <div class="traitContainer clearAllFilterButtonContainer" id="clearFilterContainer">

          <!--filled from js-->
        </div>

        <div class="traitGroupContainer" id="stringTraitGroupContainer">

          <!--filled from js-->
        </div>

        <div class="traitGroupContainer" id="intTraitGroupContainer">

          <!--filled from js-->
        </div>


      </div>

      <div class="rightPanelContainer" id="rightPanelContainer">
        <div class="tokenDisplayContainer" id="tokenDisplayContainer">

        </div>
        <div class="historyContainer" id="historyContainer">

        </div>
      </div>

    </div>


  </main>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.1/dist/web3.min.js"></script>
  <script src="scripts/cacheDb.js"> </script>
  <script src="scripts/traits.js"> </script>
  <script src="scripts/fancyLogs.js"> </script>
  <script>

    let blockPerLogRequest = 20000;
    
    function setupWegGl(tokenInfo) {

      //Build FightBoxContainer
      var fightBoxContainer = document.createElement("div");
      fightBoxContainer.id = "fightBoxContainer";
      fightBoxContainer.classList = "fightBoxContainer";
      fightBoxContainer.innerHTML = ``;

      //Build webglHeader
      var webglHeader = document.createElement("div");
      webglHeader.classList = "webglHeader";
      webglHeader.innerHTML = ``;

      //build webGlClose
      var webGlClose = document.createElement("button");
      webGlClose.classList = "webGlClose";
      webGlClose.innerHTML = ` X `;
      webGlClose.addEventListener('click', function (e) {
        let gainlingContainer = document.getElementById("fightBoxContainer");
        document.body.removeChild(gainlingContainer);
        refresh();
      });

      //webglHeader.appendChild(webGlClose);
      fightBoxContainer.appendChild(webGlClose);

      //build webglFrame
      var height = device < 2 ? '506px' : '406';
      var webglFrame = document.createElement("iframe");
      webglFrame.classList = "webglFrame";
      webglFrame.innerHTML = ``;
      //webglFrame.maxHeight = '506px';
      //webglFrame.maxWidth = '505px';
      webglFrame.height = '506px';
      webglFrame.width = '496px';
      webglFrame.width = '104%';
      webglFrame.src = animationUrl + `tokenId=${tokenInfo.id}`
      fightBoxContainer.appendChild(webglFrame);

      //Build webGlButtonCover
      var webGlButtonCover = document.createElement("div");
      webGlButtonCover.classList = "webGlButtonCover";
      webGlButtonCover.innerHTML = ``;
      fightBoxContainer.appendChild(webGlButtonCover);

      //Build webGlFooter
      var webGlFooter = document.createElement("div");
      webGlFooter.classList = "webGlFooter";
      webGlFooter.innerHTML = ``;

      //build webGlTokenInfoText
      let outputText = `Seems to be alive`;
      if (!connected) outputText = `Connect metamask first`;
      else if (clientSelectedToken < 0) outputText = `Select player first`;

      var webGlTokenInfoText = document.createElement("a");
      webGlTokenInfoText.id = "webGlTokenInfoText";
      webGlTokenInfoText.classList = "webGlTokenInfoText";
      webGlTokenInfoText.innerHTML = outputText;

      //build webGlAttackButton
      var webGlAttackButton = document.createElement("button");
      webGlAttackButton.id = "webGlAttackButton";
      webGlAttackButton.classList = "webGlAttackButton";
      webGlAttackButton.innerHTML = `ATTACK`;

      webGlAttackButton.addEventListener('click', function (e) {

        if (!connected) {
          reject('Not connected to metamask');
          return;
        }

        attackGainling(clientSelectedToken, tokenInfo.id)
          .then(attackResult => {
            console.log("Success Attack result: " + attackResult);
          })
          .catch((error) => {
            console.log("Catched Attack result: " + error.message);
            updateOutputTextFromJsonRPC(error.message);
          });

      });


      webGlFooter.appendChild(webGlTokenInfoText);
      webGlFooter.appendChild(webGlAttackButton);
      fightBoxContainer.appendChild(webGlFooter);
      document.body.appendChild(fightBoxContainer);
    }
    function buildElement(elementType, id, classList, content) {
      var divElement = document.createElement(elementType);
      divElement.id = id;

      if (typeof classList === 'undefined')
        return divElement;

      divElement.classList = classList;
      if (typeof content === 'undefined')
        return divElement;

      divElement.innerHTML = `${content.toString()}`
      return divElement;
    }
    function getStackedImageNew(tokenInfo, spareBase = false) {
      //Build stackContainer
      var stackContainer = buildElement("div", "sixImagesInOne", "sixImagesInOne");


      var characterImage = buildElement("img", "imageTop", "imageTop imageFull");
      characterImage.src = "assets/sprites/Character.png";

      if (!spareBase) {
        let aura = tokenInfo.metadata[5];
        var auraImage = buildElement("img", "imageBehind", "imageBehind imageFull");
        auraImage.src = `assets/traits/Aura/${aura}.png`;
        stackContainer.appendChild(auraImage);
      }
      else {
        var signerImage = buildElement("img", "imageBehind", "imageBehind imageFull");
        signerImage.src = `assets/sprites/PartsSigner.png`;
        stackContainer.appendChild(signerImage);
      }
      stackContainer.appendChild(characterImage);
      //console.log(JSON.stringify(tokenInfo.metadata));
      for (let index = 0; index < tokenInfo.metadata.length - 1; index++) {

        let attribute = tokenInfo.metadata[index];
        var traitImage = document.createElement("img");
        let path = `assets/traits/${_traitTypeNames[index]}/${attribute}.png`;
        traitImage.src = path;
        traitImage.classList = "imageTop imageFull";
        stackContainer.appendChild(traitImage);
      }
      return stackContainer;
    }

    /*_________________________________________________________________________
    CLIENT DEVICE HANDLING CLIENT DEVICE HANDLING CLIENT DEVICE HANDLING 
    `````````````````````````````````````````````````````````````````````````*/
    function getResolution() {
      var devicenow = 2;
      var devicenowString = "mobile";

      var width = measureBox.clientWidth * window.devicePixelRatio;
      var height = measureBox.clientHeight * window.devicePixelRatio;
      var ratioT = height > width;
      if (width > 1100 && !ratioT) {
        devicenow = 0;
        devicenowString = "desktop";
      }
      else if (width > 420 && !ratioT) {
        devicenow = 1
        devicenowString = "tablet";
      }
      if (devicenow != device) {
        device = devicenow;
        deviceString = devicenowString;
        changeView(device);
      }
    }
    function changeView(newDevice) {
      console.log("Switched resolution to " + deviceString);
      setClientTokenSelectorText();
      setClientTokenSelectorSize();
    }
